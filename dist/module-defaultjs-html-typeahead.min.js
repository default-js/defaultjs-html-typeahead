(()=>{var t={353:()=>{String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++)t=(t<<5)-t+this.charCodeAt(n),t|=0;return t})}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{HTMLTypeaheadElement:()=>Ne});class t{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(e,n,r=!0){let o=e;const s=n.split(".");let a=s.shift().trim();for(;s.length>0;){if(!o[a]){if(!r)return null;o[a]={}}o=o[a],a=s.shift().trim()}return new t(a,o)}}const e=t=>null==t||void 0===t,o=t=>{if(null==t)return!0;switch(typeof t){case"number":case"bigint":case"boolean":case"string":case"undefined":return!0}return!1},s=t=>!(e(t)||"object"!=typeof t||t.constructor&&"Object"!==t.constructor.name),a=(t,n)=>{const r=e(t),s=e(n);if(r||s)return t===n;if(o(t)||o(n))return t===n;const i=typeof t;return i==typeof n&&("function"===i?t===n:((t,e)=>{const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const r of n){const n=t[r],o=e[r];if(!a(n,o))return!1}return!0})(t,n)&&((t,e)=>{const n=Object.getPrototypeOf(t),r=Object.getPrototypeOf(e);if(n!=r)return!1;if(!n)return!0;const o=Object.getOwnPropertyNames(n),s=Object.getOwnPropertyNames(r);if(o.length!==s.length)return!1;for(const n of o){const r=t[n],o=e[n];if(!a(r,o))return!1}return!0})(t,n))},i=t=>{if(!s(t))return!1;for(const e in t)if("function"==typeof t[e])return!1;return!0},c=function(t,...e){t||(t={});for(let n of e)i(n)&&Object.getOwnPropertyNames(n).forEach((e=>{i(t[e])?c(t[e],n[e]):t[e]=n[e]}));return t},l=function(){const[t,e,{deep:n=!1,recursive:r=!0,parents:o=[]}={}]=arguments,s={};for(let a in t){const i=t[a],c=e(a,i,t);!c||n&&null!=i?c&&n&&("object"!=typeof i||i instanceof Array||i instanceof Map||i instanceof Set||i instanceof RegExp||o.includes[i]||i==t?s[a]=i:s[a]=l(i,e,{deep:n,recursive:r,parents:o.concat(t)})):s[a]=i}return s},u=(t,e,n)=>{Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!1})},h=(t,e,n)=>{Object.defineProperty(t,e,{get:n,configurable:!1,enumerable:!1})},p={isNullOrUndefined:e,isObject:s,equalPojo:a,isPojo:i,append:function(e,n,r){return void 0!==n&&(t.load(r,e,!0).append=n),r},merge:c,filter:l,buildPropertyFilter:function({names:t,allowed:e}){return(n,r,o)=>t.includes(n)===e},defValue:u,defGet:h,defGetSet:(t,e,n,r)=>{Object.defineProperty(t,e,{get:n,set:r,configurable:!1,enumerable:!1})}},f=()=>{let t=null,e=null;const n=new Promise(((n,r)=>{t=n,e=r}));let r,o=!1,s=!1;return u(n,"resolve",(n=>{r=n,o=!0,r instanceof Error?(s=!0,e(r)):t(r)})),h(n,"value",(()=>r)),h(n,"error",(()=>s)),h(n,"resolved",(()=>o)),n},d=()=>{const t=new Uint32Array(4);window.crypto.getRandomValues(t);let e=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(n=>{e++;const r=t[e>>3]>>e%8*4&15;return("x"==n?r:3&r|8).toString(16)}))},m=(t,e,n=":")=>{let r="unsupported";if("string"==typeof e)r=e;else if(e instanceof HTMLElement)r=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');r=e.NODENAME}return`${r.toLowerCase()}${n}${t}`},g=(t,e)=>{let n=0,r=null;for(;n<100;){if(r=`${t||""}${d()}${e||""}`,!document.getElementById(r))return r;n++}return console.error(new Error("To many retries to create an unique id - created id is not unique!")),r},y=t=>class extends t{static get NODENAME(){return this.nodeName.toLowercase()}static get observedAttributes(){return[]}#t=null;#e=[];constructor({shadowRoot:t=!1,content:e=null,createUID:n=!1,uidPrefix:r="id-",uidSuffix:o="",postConstucts:s=null}={}){if(super(),this.#t=f(),n&&this.#e.push((async()=>this.attr("id",g(r,o)))),t&&this.attachShadow({mode:"open"}),e&&this.root.append("function"==typeof e?e(this):e),s instanceof Array)for(let t of s)"function"==typeof t&&this.#e.push(t)}get postConstructs(){return this.#e}get root(){return this.shadowRoot||this}get ready(){return this.#t}async init(){for(let t of this.#e)await t(this)}async destroy(){this.ready.resolved&&(this.#t=f())}connectedCallback(){this.ownerDocument==document&&this.isConnected&&this.init().then((t=>this.#t.resolve(t))).catch((t=>this.#t.resolve(t)))}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,n){e!=n&&this.isConnected&&(this.trigger(10,((t,e,n=":")=>m(`attribute--${t}`,e,n))(t,this)),this.trigger(10,m("change",this)))}disconnectedCallback(){this.destroy()}},v=new Map,w=t=>{let e=v.get(t);return null==e&&(e=y(t),v.set(t,e)),e},x=w(HTMLElement),b=(t,e)=>"string"==typeof e?e+t:"d-"+t,E=function(t,e){const n=t.NODENAME;customElements.get(n)||customElements.define(n,t,e)},T=new WeakMap,N=function(t,e,n){const r=(t=>{if(T.has(t))return T.get(t);const e={};return T.set(t,e),e})(t);if(1===arguments.length)return r;if(2===arguments.length)return r[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");r[e]=n},A=t=>function(e,n){if(2!=arguments.length)return N(e,t);N(e,t,n)},L=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;)t.shift()(e)},M={global:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===M.global[t]&&(M.global[t]=e),M.global[t]}},j=M,C=j.globalVar("___DOM_API_EXTENSION_MAP___",{}),S=function(t,e){return function(n){let r=C[n.name];r||(r=C[n.name]={}),r[t]?console.warn('duplicated load of extension "'+t+'"!'):(r[t]=!0,e(n.prototype))}},P=S("EventSupport",(t=>{const e=/(\s+)|(\s*,\s*)/,n=t=>(t.__wrapperhandlemap__||(t.__wrapperhandlemap__=new Map),t.__wrapperhandlemap__),r=(t,r,o)=>{const{wrapper:s,option:a,events:i,handle:c}=r,l=a.capture;if(o){o="string"==typeof o?o.split(e):o;for(let e of o){const r=i.indexOf(e);r>=0&&(t.removeEventListener(e,s,l),i.splice(r,1)),0==i.length&&n(t).delete(c)}}else{for(let e of i)t.removeEventListener(e,s,l);n(t).delete(c)}};t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments);let o="string"==typeof t[0]?t.shift().split(e):t.shift();const s="string"==typeof t[0]?t.shift():null,a=t.shift(),i=void 0===t[0]?{capture:!1,once:!1,passive:!1}:"boolean"==typeof t[0]?{capture:t.shift(),once:!1,passive:!1}:t.shift(),c=function(t){if(s){const e=t.target;if("function"==typeof e.is&&!e.is(s))return}const e=a.apply(null,arguments);return i.once&&r(this,c),e};n(this).set(a,{handle:a,wrapper:c,events:o,option:i});for(let t of o)this.addEventListener(t,c,i);return this},t.removeOn=function(t,e,o){const s=n(this).get(t);return s?r(this,s,e):this.removeEventListener(t,e,o),this},t.trigger=function(){const t=Array.from(arguments),e="number"==typeof t[0]?t.shift():-1;if(e>=0){const n=t[0],r=(this.___EVENTTRIGGERTIMEOUTS___||(this.___EVENTTRIGGERTIMEOUTS___={}),this.___EVENTTRIGGERTIMEOUTS___),o=r[n];o&&clearTimeout(o),r[n]=setTimeout((()=>{delete r[n],this.trigger.apply(this,t)}),e)}else{const e=t.shift(),n=t[0]instanceof Event?t.shift():null,r=t.length>=1?1==t.length?t.shift():t:n,o=r?new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:r}):new Event(e,{bubbles:!0,cancelable:!0,composed:!0});n&&(o.delegatedEvent=n),this.dispatchEvent(o)}return this}}));L(EventTarget,P);const H=S("DataSupport",(t=>{t.data=function(){const t={};if(void 0!==this.dataset)for(name in this.dataset)t[name]=this.dataset[name];return this.data=function(){return 0==arguments.length?t:1==arguments.length?t[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete t[arguments[0]]:t[arguments[0]]=arguments[1],this)}.bind(this),this.data.apply(null,arguments)}})),O=S("ManipulationSupport",(t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach((t=>{this.empty(),("string"==typeof t||t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection)&&this.append(t)})),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach((n=>t.insertBefore(n,e))),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}}));L(Node,H,O);const D=/:parent(\(\"([^\)]*)\"\))?/i,_=function(t,e){let n=D.exec(e);if(!n)return t.querySelectorAll(e);{let r=t;if(n.index>0&&(r=t.querySelectorAll(e.substr(0,n.index)),0==r.length))return;if(r=r.parent(n[2]),r){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(r=r.find(t)),r}}},k=S("QuerySupport",(t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=_(this,n);e&&t.push(e)}n=e.shift()}return NodeList.from.apply(null,t)},t.is=function(){if(this instanceof Document||this instanceof DocumentFragment)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(t,e){if(!this.parentNode)return null;e="boolean"==typeof t?t:e,t="string"==typeof t?t:null;let n=this.parentNode;if(n instanceof ShadowRoot&&e&&(n=n.host),t){try{for(;n&&!n.is(t);)n=n.parent(t,e)}catch(t){console.error("this:",this,"parent:",n,"error:",t)}return n}return n},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let r=e.selector();return r?r+">"+t:t}return t}}},t.closest=function(t){return this.closests(t).first()},t.closests=function(t){const e=this.find(t);if(0!=e.length)return e;const n=this.parentElement;return n?n.closests(t):NodeList.from([])},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}})),R=k,I=S("AttributeSupport",(t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach((e=>{t[e]=this.getAttribute(e)})),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}}));L(Element,R,I,O);const $=S("ReadyEventSupport",(t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}}));L(Document,R,$),document.addEventListener("DOMContentLoaded",(()=>document.trigger("ready"))),L(DocumentFragment,R,O);const U=S("HtmlClassSupport",(t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.add(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.add(t))),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.remove(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.remove(t))),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.toggle(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.toggle(t))),this}})),q="none",V=t=>t.style.display===q,K=t=>{let e=V(t)?"":t.style.display;return t.show=function(){return this.style.display=e,this}.bind(t),t.hide=function(){return this.style.display=q,this}.bind(t),t},F=S("ShowHideSupport",(t=>{t.show=function(){return K(this).show.apply(null,arguments)},t.hide=function(){return K(this).hide.apply(null,arguments)},t.toggleShow=function(){return V(this)?this.show():this.hide()}}));L(HTMLElement,U,F);const z=[{selector:"select",get:function(){const t=[];return this.find("option").forEach((e=>{e.selected&&t.push(e.value)})),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach((e=>e.selected=t.indexOf(e.value)>=0)),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],G={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},B=S("ValueSupport",(t=>{t.val=function(){let t=function(t){for(let e=0;e<z.length;e++)if(t.is(z[e].selector))return z[e];return G}(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}}));L(HTMLInputElement,B),L(HTMLTextAreaElement,S("ValueSupport",(t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}}))),L(HTMLSelectElement,B);const X=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach((t=>{Object.getOwnPropertyNames(t).forEach((r=>{const o=Object.getOwnPropertyDescriptor(t,r);void 0===n[r]&&"function"==typeof o.value&&(n[r]=function(){return e.call(this,r,arguments)})}))}))},J=S("ListSupport",(t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}}));L(NodeList,J),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const s=this[o];let a;n?a=e.apply([s].concat(t)):"function"==typeof s[e]&&(a=s[e].apply(s,t)),a&&r.push(a)}return r},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{"function"==typeof e.val&&e.val()&&t.set(e.name||e.id||e.selector(),e.val())})),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof Node)e[n++]={value:r,enumerable:!0};else if(r instanceof NodeList||r instanceof HTMLCollection||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof Node&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},X((function(t,e){let n=[];return this.forEach((r=>{if(r&&"function"==typeof r[t]){const o=r[t].apply(r,e);o&&(o instanceof NodeList?n=n.concat(Array.from(o)):n.push(o))}})),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from(n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),L(HTMLCollection,J),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,r=[];for(let o=0;o<this.length;o++){const s=this[o];let a;n?a=e.apply([s].concat(t)):"function"==typeof s[e]&&(a=s[e].apply(s,t)),a&&r.push(a)}return r},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{"function"==typeof e.val&&e.val()&&t.set(e.name||e.id||e.selector(),e.val())})),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const r=t.shift();if(void 0!==r&&null!=r)if(r instanceof HTMLElement)e[n++]={value:r,enumerable:!0};else if(r instanceof HTMLCollection||r instanceof NodeList||r instanceof Array)for(let t=0;t<r.length;t++)r[t]&&r[t]instanceof HTMLElement&&(e[n++]={value:r[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},X((function(t,e){let n=[];return this.forEach((r=>{if(r&&"function"==typeof r[t]){let o=r[t].apply(r,e);o&&(o instanceof HTMLCollection?n=n.concat(Array.from(o)):n.push(o))}})),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),j.global.defaultjs=j.global.defaultjs||{},j.global.defaultjs.extdom=j.global.defaultjs.extdom||{VERSION:"1.5.7",utils:{Utils:j}},j.global.find=function(){return document.find.apply(document,arguments)},j.global.ready=function(){return document.ready.apply(document,arguments)},j.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},j.global.script=function(t,e){return t instanceof Array?Promise.all(t.map((t=>j.global.script(t,e)))):"string"==typeof t?new Promise(((n,r)=>{const o=document.createElement("script");o.async=!0,o.onload=function(){n()},o.onerror=function(){throw new Error("load error!")},e?e.append(o):document.body.append(o),o.src=t})):Promise.reject("First parameter must be an array of strings or a string!")};const Q=void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class W{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class Z{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:r}=this.getPropertyDef(t);r?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Y{#n=null;#r=null;constructor(t,e){this.#n=new Z(t,e),this.#r=new Proxy(this.#n,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}get data(){return this.#r}get handle(){return this.#n}updateData(t){this.#n.updateData(t)}resetCache(){this.#n.resetCache()}}const tt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,et=new Map,nt=new W,rt=t=>t instanceof W?t:new W(t),ot=async function(t,e,n,r){if(n&&t.name!=n)return t.parent?ot(t.parent,e,n,r):null;const o=await async function(t,e){if("string"!=typeof t)return t;if(null==(t=at(t)))return t;try{const n=(t=>{if(et.has(t))return et.get(t);const e=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context);`);return et.set(t,e),e})(t);return await n(e)}catch(e){console.error(`Error by statement "${t}":`,e)}}(e,t.proxy.data);return null!=o?o:r instanceof W&&r.hasValue?r.value:void 0},st=async(t,e,n)=>e[1]?e[2]:ot(t,e[5],at(e[4]),n),at=t=>t?0==(t=t.trim()).length?null:t:null;class it{constructor({context:t=Q,parent:e=null,name:n=null}){this.parent=e instanceof it?e:null,this.name=n,this.context=t,this.proxy=new Y(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(e,n){if(e){if(!n||n==this.name){const n=t.load(this.context,e,!1);return n?n.value:null}this.parent&&this.parent.getData(e,n)}}updateData(e,n,r){e&&(r&&r!=this.name?this.parent&&this.parent.updateData(e,n,r):(null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context)),t.load(this.context,e).value=n,this.proxy.resetCache()))}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?p.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?rt(e):nt;try{const e=tt.exec(t);return e?await st(this,e,n):await ot(this,at(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,r=t,o=tt.exec(n);const s=2==arguments.length?rt(e):nt;for(;null!=o;){const t=await st(this,o,s);r=r.split(o[0]).join(),n=n.split(o[0]).join(void 0===t?"undefined":null==t?"null":t),o=tt.exec(r)}return n}static async resolve(t,e,n,r){const o=new it({context:e}),s=arguments.length>2?rt(n):nt;return"number"==typeof r&&r>0?new Promise((e=>{setTimeout((()=>{e(o.resolve(t,s))}),r)})):o.resolve(t,s)}static async resolveText(t,e,n,r){const o=new it({context:e}),s=arguments.length>2?rt(n):nt;return"number"==typeof r&&r>0?new Promise((e=>{setTimeout((()=>{e(o.resolveText(t,s))}),r)})):o.resolveText(t,s)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:r,parent:o}){return t=p.filter({data:t,propFilter:e,option:n}),new it({context:t,name:r,parent:o})}}n(353);const ct={},lt=async(t,e,n)=>ut(create(t,!0),e,n),ut=async(t,e,n)=>{let r=null;if(t instanceof HTMLTemplateElement)r=new ht(t,n);else{if(r=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");r.content.append(t.cloneNode(!0)),r=new ht(r,n)}if(!r)throw new Error("Template can't loaded!");return e&&n&&(ct[n]=r),r};class ht{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&ct[this.key]&&delete ct[this.key]}static async fetch(t,e=!0,n=null){return"string"==typeof t?ht.load(new URL(t,loaction),e,n):t instanceof URL?ht.load(t,e,n):void new Error("The url isn't a allowed type! -> [String|URL] required!")}static async load(t,e=!0,n=null){if(t instanceof ht)return t;const r=((t,e,n)=>{if(!e)return null;let r=null;return n?r=n:"string"==typeof t?r=t:t instanceof URL?r=t.toString():t instanceof HTMLElement&&(r=t.selector()),r?r.hashcode():null})(t,e,n);return r&&ct[r]?ct[r]:"string"==typeof t?lt(t,e,r):t instanceof URL?await(async(t,e,n)=>{const r=await fetch(t.toString()),o=await r.text();return lt(o,e,n)})(t,e,r):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof HTMLTemplateElement?ut(t,e,r):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}static async loadNodeTemplate(t,e,n,r){try{const e=(t=>{let e=t.find(":scope > template").first();if(e)return e;const n=t.attr("template");if(!n)return null;try{if(e=find(n).first(),e)return e}catch(t){}return new URL(n,location)})(t);if(e)return ht.load(e,n,r)}catch(e){console.warn("Can't load template from node!",t,e)}return e}}const pt=[],ft={init:0,data:1,template:2,content:3,finish:4};class dt{static get PHASE(){return ft}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return ft.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof dt))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<dt.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+dt.MIN_RANK+"!");if(t.rank>dt.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+dt.MAX_RANK+"!");pt.push(t),pt.sort(((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n}))})(t)}static get directives(){return pt}}new Set,new Map;const mt=t=>t instanceof ht?t.importContent():typeof t===String?create(t):t;let gt=0;class yt{#o;#s;#a;#i;#c;#l;#u;#h;#p;#f;#d;constructor({content:t=null,resolver:e,renderer:n,template:r,container:o,root:s,mode:a="replace",target:i=null,parent:c=null,wait:l=null,callbacks:u=null,ignoreDirective:h}){if(!e)throw new Error('Parameter "resolver" is required!');if(!n)throw new Error('Parameter "renderer" is required!');if(!r)throw new Error('Parameter "template" is required!');if(!o)throw new Error('Parameter "container" is required!');if(!s)throw new Error('Parameter "root" is required!');this.#o=c?`${c.id}->${gt++}`:"root::"+gt++,this.#s=c?c.depth+1:0,this.#a=c,this.#i=n,this.#c=s,this.#l=mt(r),this.#u=a,this.#h=new Set,this.#p=l||f(),this.#f=h instanceof Set?h:new Set,this.#d=u instanceof Array?u:[],this.content=t,this.container=o,this.target=i,this.resolver=e,this.stop=!1,this.ignore=!1,c&&c.subcontexts.add(this)}get id(){return this.#o}get depth(){return this.#s}get parent(){return this.#a}get renderer(){return this.#i}get root(){return this.#c}get template(){return this.#l}set template(t){this.#l=mt(t)}get mode(){return this.#u}get subcontexts(){return this.#h}get closed(){return this.#p.resolved}ignoreDirective(t){const e=this.#f;t instanceof dt?e.add(t.name):e.add(t)}acceptDirective(t){const e=this.#f;return t instanceof dt?!(e.has(t.name)||e.has(t)):!e.has(t)}finished(t){this.parent?this.parent.finished(t):this.ready(t)}async ready(t){const e=this.#d;if(!t){const t=this.#p;if(!t.resolved){if(!this.ignore)for(let t of e)await t(this);for(let t of this.subcontexts)await t.ready();this.parent&&this.parent.subcontexts.delete(this),t.resolve(this)}return t}t instanceof Array?t.forEach((t=>this.wait.then(t))):t instanceof Promise?e.push((async()=>await t)):"function"==typeof t&&e.push(t)}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:r=this.container,root:o=this.root,mode:s=this.mode,target:a=this.target,ignoreDirective:i=null}={}){return new yt({resolver:t,renderer:e,template:n,container:r,mode:s,root:o,target:a,parent:this,ignoreDirective:i})}clone({content:t=this.content,template:e=this.template,container:n=this.container,root:r=this.root,mode:o=this.mode,target:s=this.target,ignoreDirective:a=this.#f}={}){return new yt({content:t,resolver:this.resolver,renderer:this.renderer,template:e,container:n,root:r,mode:o,target:s,ignoreDirective:a,wait:this.#p,callbacks:this.#d})}toRenderOption({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:r=this.container,root:o=this.root,mode:s=this.mode,target:a=this.target,ignoreDirective:i=null}={}){return{resolver:t,renderer:e,template:n,container:r,mode:s,root:o,target:a,parent:null,ignoreDirective:i}}}class vt extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class wt extends vt{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",wt)}catch(t){}dt.define({directive:new class extends dt{constructor(){super()}get name(){return"initial"}get rank(){return dt.MIN_RANK}get phase(){return dt.PHASE.init}async execute(t){const{template:e,renderer:n,resolver:r}=t;if(e instanceof Element)if(e.attr("jstl-ignore"))t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else if(e.attr("jstl-async")){t.content=new wt,e.attr("jstl-async",null);const r=t.toRenderOption({mode:"replace",target:t.content});setTimeout((()=>{n.render(r)}),parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0}else if(e instanceof HTMLTemplateElement){t.content=document.createElement(e.tagName);const r=t.subContext({template:e.content.childNodes,container:t.content.content});await n.render(r),t.stop=!0,t.ignore=!0}else if(e.hasAttribute("jstl-tagname"))e.attr("jstl-tagname").trim().length>0?t.content=document.createElement(await r.resolveText(e.attr("jstl-tagname"))):(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0);else if(e.tagName){let n=e.attr("is");if(n){n=await r.resolveText(n);const o=document.createElement(e.tagName,{is:n});o.attr("is",n),t.content=o}else t.content=document.createElement(e.tagName)}else t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else t.content=document.importNode(e,!0);return t}}});const xt={remote:async({data:t,context:e})=>{const{resolver:n,template:r}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let o=await n.resolveText(r.attr("jstl-data-option")||"{}");return o=JSON.parse(o),(t=await fetch(t.toString(),o)).json()},set:async({data:t,context:e})=>{const{resolver:n}=e;return await n.resolve(t)},direct:async({data:t,context:e})=>{const{resolver:n}=e;return await n.resolveText(t)}};dt.define({directive:new class extends dt{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return dt.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=xt[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let r=e.attr("jstl-data");r=await n({data:r,context:t});t=(({varname:t,data:e,scope:n,context:r})=>{if(t)r.resolver.updateData(t,e,n);else if(n)r.resolver.mergeContext(e,n);else{const t=new it({context:e,name:"jstl-data",parent:r.resolver});r.resolver=t}return r})({varname:e.attr("jstl-data-var"),data:r,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}}),dt.define({directive:new class extends dt{constructor(){super()}get name(){return"if"}get rank(){return dt.MIN_RANK+1e3}get phase(){return dt.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),r=t.resolver;return await r.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}}),dt.define({directive:new class extends dt{constructor(){super()}get name(){return"choose"}get rank(){return dt.MIN_RANK+1}get phase(){return dt.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;t.template=t.template.cloneNode(!0);const{template:e,resolver:n}=t;let r=!1;const o=e.find(":scope > [jstl-when]"),s=o.length;for(let t=0;t<s;t++){const e=o[t];!r&&await n.resolve(e.attr("jstl-when"),!1)?r=!0:e.remove()}return r&&e.find(":scope > [jstl-otherwise]").remove(),t}}}),dt.define({directive:new class extends dt{constructor(){super()}get name(){return"include"}get rank(){return dt.MIN_RANK}get phase(){return dt.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:r}=t;let o=e.attr("jstl-include");o=await n.resolveText(o),o=new URL(o,location),o=await ht.load(o);const s=e.attr("jstl-include-mode")||"replace",a=t.subContext({template:o,container:t.content,mode:s});return await r.render(a),await a.ready(),t.ignore=!0,t.stop=!0,t}catch(e){return console.error(e,t.template),t}}}});const bt="jstl-foreach",Et="jstl-foreach-count",Tt=async(t,e)=>{let{template:n,resolver:r,renderer:o,container:s,condition:a,context:i}=e;if(r=new it({context:t,name:"jstl-foreach",parent:r}),a=!!a&&await r.resolve(a,!1),a)return!1;const c=i.subContext({resolver:r,container:s,template:n,mode:"append"});return await o.render(c),await c.ready(),!0};dt.define({directive:new class extends dt{constructor(){super()}get name(){return"foreach"}get rank(){return dt.MIN_RANK+2}get phase(){return dt.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(bt)&&!t.template.attr(Et))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:r,content:o}=t,s={data:(e.attr(bt)||"").trim(),count:(e.attr(Et)||"").trim(),start:await n.resolve(e.attr("jstl-foreach-start")||"0"),step:await n.resolve(e.attr("jstl-foreach-step")||"1"),varname:(e.attr("jstl-foreach-var")||"item").trim(),status:(e.attr("jstl-foreach-status")||"status").trim(),condition:e.attr("jstl-foreach-condition"),template:e.childNodes,resolver:n,renderer:r,container:o,context:t};s.data&&""!=s.data||!s.count?await(async t=>{let{data:e,start:n,step:r,count:o,varname:s,status:a,resolver:i}=t;e=await i.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),o=""!=o?await i.resolve(o,0):null;const l=o?Math.min(n+o,c.length):c.length;let u=!1;for(let o=n;o<l&&!u;o+=r){const n={};n[s]=e[o],n[a]={index:o,number:o+1,count:l,data:e},u=!await Tt(n,t)}})(s):await(async t=>{let{start:e,step:n,count:r,varname:o,status:s,resolver:a}=t;r=await a.resolve(r);const i=e+r*n;let c=!1;for(let a=e;a<i&&!c;a+=n){const e={};e[o]=a,e[s]={index:a,number:a+1,step:n,count:r},c=!await Tt(e,t)}})(s)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const Nt="jstl-repeat",At=new Set([Nt]),Lt={DATA:`${Nt}`,VAR:`${Nt}-var`,STATUS:`${Nt}-status`,COUNT:`${Nt}-count`,START:`${Nt}-start`,STEP:`${Nt}-step`,CONDITION:`${Nt}-condition`},Mt=async(t,e)=>{let{template:n,resolver:r,renderer:o,condition:s,context:a}=e;if(r=new it({context:t,name:Nt,parent:r}),s=!!s&&await r.resolve(s,!1),s)return!1;const i=a.subContext({resolver:r,template:n,mode:"append",ignoreDirective:At});return await o.render(i),await i.ready(),!0};dt.define({directive:new class extends dt{constructor(){super()}get name(){return Nt}get rank(){return dt.MIN_RANK+3}get phase(){return dt.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Lt.DATA)&&!t.template.attr(Lt.COUNT))return t;try{const{template:e,resolver:n,renderer:r,content:o,container:s}=t,a={data:(e.attr(Lt.DATA)||"").trim(),count:(e.attr(Lt.COUNT)||"").trim(),start:await n.resolve(e.attr(Lt.START)||"0"),step:await n.resolve(e.attr(Lt.STEP)||"1"),varname:(e.attr(Lt.VAR)||"item").trim(),status:(e.attr(Lt.STATUS)||"status").trim(),condition:e.attr(Lt.CONDITION),template:e,tagname:o.tagName,resolver:n,renderer:r,container:s,context:t};a.data&&""!=a.data||!a.count?await(async t=>{let{data:e,start:n,step:r,count:o,varname:s,status:a,resolver:i}=t;e=await i.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),o=""!=o?await i.resolve(o,0):null;const l=o?Math.min(n+o,c.length):c.length;let u=!1;for(let o=n;o<l&&!u;o+=r){const n={};n[s]=e[o],n[a]={index:o,number:o+1,count:l,data:e},u=!await Mt(n,t)}})(a):await(async t=>{let{start:e,step:n,count:r,varname:o,status:s,resolver:a}=t;r=await a.resolve(r);const i=e+r*n;let c=!1;for(let a=e;a<i&&!c;a+=n){const e={};e[o]=a,e[s]={index:a,number:a+1,step:n,count:r},c=!await Mt(e,t)}})(a)}catch(t){console.error("error at jstl-repeat:",t)}return t.content=null,t.stop=!0,t.ignore=!0,t}}});const jt={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},Ct={text:async(t,e)=>{const{content:n,resolver:r,template:o}=e;let s=await r.resolveText(o.textContent);s=create(s,!0).content.textContent,t.maxLength>0&&(s=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(s,t.maxLength)),n.textContent=s},html:async(t,e)=>{const{resolver:n,template:r}=e;let o=await n.resolveText(r.textContent);o=create(o,!0),o=document.importNode(o.content,!0),t.unsecure||o.find("script, style, body, html, head, object, link").remove(),e.content=o}};dt.define({directive:new class extends dt{constructor(){super()}get name(){return"text"}get rank(){return dt.MIN_RANK+1}get phase(){return dt.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,r=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):jt,o=Ct[r.mode];if(!o)throw new Error('Text mode "'+r.mode+'" is unsupported!');return await o(r,t),t}}});const St=/(jstl)?(\?)?(@)?([^\?@]+)/i,Pt="default",Ht="prevent-default",Ot=["is"],Dt={delegate:async(t,e,n,r,o,s,a,i)=>{const c=await o.resolveText(e,e);s.on(t,$t(c,n))},toggleclass:async(t,e,n,r,o,s,a,i)=>{const c=a.shift(),l=a.includes(Ht),u=e?await o.resolveText(e,e):null;s.on(t,(t=>{l&&t.preventDefault(),u?s.closests(u).toggleClass(c):s.toggleClass(c)}))},toggleattribute:async(t,e,n,r,o,s,a,i)=>{const c=a.shift(),l=a.includes(Ht),u=e?await o.resolveText(e,e):null;s.on(t,(t=>{l&&t.preventDefault(),u?s.closests(u).forEach((t=>{t.toggleAttribute(c)})):s.toggleAttribute(c)}))},[Pt]:async(t,e,n,r,o,s,a,i)=>{const c=e?await o.resolve(e,e):null;if(c){if("function"==typeof c)s.on(t,c);else if("string"==typeof c)s.on(t,$t(c,n));else if("object"==typeof c){const{capture:e=!1,passive:n=!1,once:r=!1}=c;s.on(t,c.eventHandle,{capture:e,passive:n,once:r})}}else console.error(new Error("Can't resolve \""+e+'" to event handle!'))}},_t=async({condition:t,name:e,value:n,context:r})=>{const{resolver:o,content:s,template:a}=r;let i=t?a.attr(e):n;t=t?n:a.attr("?"+e);const c=kt(i);t&&c?!0===(t=await o.resolve(t,!1))&&s.attr(e,await o.resolveText(i,i)):t?!0===(t=await o.resolve(t,!1))&&s.attr(e,!0):c&&s.attr(e,await o.resolveText(i,i))},kt=t=>null!=t&&void 0!==t,Rt=async({condition:t,name:e,value:n,context:r})=>{const{resolver:o,template:s,content:a}=r;let i=(t=t?n:s.attr("?@"+e))?s.attr("@"+e):n,c=e.split("::");1==c.length&&(c=e.split(":"));const l=c.shift(),u=(c.shift()||Pt).toLowerCase();void 0!==i&&null!=i||console.error(`Definition of "${l}" - event handle at`,a,"is incorrect!"),i=i.trim();const h={bubble:!0};t?1==await o.resolve(t,!1)&&await It(l,i,h,u,o,a,c,r):await It(l,i,h,u,o,a,c,r)},It=async(t,e,n,r,o,s,a,i)=>{const c=Dt[r];if(c)return c(t,e,n,r,o,s,a,i)},$t=function(t,e){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};dt.define({directive:new class extends dt{constructor(){super()}get name(){return"attribute"}get rank(){return dt.MIN_RANK}get phase(){return dt.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set(Ot);for(const r of e.attributes){const[,e,o,s,a]=St.exec(r.name);if(!e&&!n.has(a)){const e=r.value;s?await Rt({condition:o,event:s,name:a,value:e,context:t}):await _t({condition:o,name:a,value:e,context:t})}n.add(a)}return t}}});const Ut="jstl-attach-element",qt="replace",Vt=/^#.+$/;dt.define({directive:new class extends dt{constructor(){super()}get name(){return"attach-element"}get rank(){return dt.MIN_RANK+1}get phase(){return dt.PHASE.content}async execute(t){const{resolver:e,template:n,content:r}=t;if(!(n instanceof HTMLElement&&n.attr(Ut)))return t;try{let o=await(async(t,e)=>{let n=(t.attr(Ut)||"").trim();if(!Vt.test(n)){try{n=await e.resolve(n,n)}catch(t){}if(n instanceof HTMLElement)return n}try{n=find(n)}catch(t){}return n&&n.length>0?0==n.length?n.first():n:null})(n,e);if(o){const e=n.attr("jstl-attach-element-mode")||qt;e==qt?(r.empty().append(o),t.stop=!0,t.ignore=!0):t.ready((({content:t})=>{t&&("append"==e?t.append(o):"prepend"==e&&t.prepend(o))}))}}catch(e){console.log(e,{context:t})}return t}}});const Kt="on-finished",Ft=`jstl-${Kt}`,zt=`${Ft}-async`;dt.define({directive:new class extends dt{constructor(){super()}get name(){return Kt}get rank(){return dt.MAX_RANK}get phase(){return dt.PHASE.finish}async execute(t){const{template:e,content:n,root:r}=t;if(!(e instanceof HTMLElement&&e.hasAttribute(Ft)))return t;const o=e.attr(Ft),s=e.hasAttribute(zt),a=new it({context:{$element:n,$root:r,$template:e},name:"jstl-data",parent:t.resolver});return t.finished((async()=>{try{if(!s)return a.resolve(o,null);a.resolve(o,null)}catch(t){console.error(t)}})),t}}});const Gt=new it({name:"application"}),Bt={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},Xt=async t=>{try{let{template:e,renderer:n}=t;e instanceof vt?await e.execute(t):await Jt(t);const{ignore:r,content:o}=t;if(!r&&o){let{resolver:e}=t;const r=t.template.childNodes;if(r&&r.length>0){const s=new it({name:"container",context:null,parent:e}),a=await n.render(t.subContext({container:o,template:r,resolver:s}));await a.ready()}}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t},Jt=async t=>{const e=dt.directives,n=e.length;for(let r=0;r<n&&!t.stop;r++){const n=e[r];try{t.acceptDirective(n)&&await n.execute(t)}catch(e){console.error("error at directive:",e,n,t)}}return t};class Qt{constructor({template:t,data:e}={}){if(t&&!(t instanceof ht))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new it({name:"data",context:e||{},parent:Gt})}async render(t){const e=t instanceof yt;if(e){if(t.closed)throw new Error("calling with closed context",t)}else{let{template:e=null,data:n=null,container:r,root:o,mode:s,target:a}=t;e=await(async(t,e)=>{if(t)return(t=await ht.load(t)).importContent();if(e.template)return await e.template.importContent();throw new Error("No content template specified!")})(e,this);const i=new it({name:"render",context:n,parent:this.resolver});t=new yt({resolver:i,renderer:this,template:e,container:r,root:o||r,mode:s||"replace",target:a})}return t.template instanceof Node?await Xt(t):await(async t=>{let{template:e,resolver:n}=t;if(!e||0==e.length)return t;let r=[];for(let o of e){o.normalize();const e=new it({name:"node",context:null,parent:n}),s=await Xt(t.subContext({template:o,resolver:e}));await s.ready();const a=s.content;a&&(a instanceof Array&&(r=r.concat(a)),a instanceof NodeList||a instanceof HTMLCollection?r=r.concat(Array.from(a)):a instanceof Node&&r.push(a))}return t.content=0!=r.length?r:null,t})(t),await(async t=>{if(t.content){const e=Bt[t.mode];if(!e)throw new Error('The "'+t.mode+'" is not supported!');await e(t)}})(t),e||await t.ready(),t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await ht.load(t):null,new Qt({template:t,data:e})}static async render({container:t,data:e,template:n,mode:r,target:o}){return new Qt({template:n,data:e}).render({container:t,mode:r,target:o})}}const Wt=b("json-data"),Zt="json";class Yt extends x{static get NODENAME(){return Wt}constructor(){super(),this.style.display="none !important";const t=new MutationObserver((()=>{this.reinit()}));t.observe(this,{childList:!0,characterData:!0}),N(this,"observer",t),N(this,Zt,null)}async init(){}async reinit(){N(this,Zt,null)}get json(){return(async()=>{await this.ready;let t=N(this,Zt);return t||(t=JSON.parse(this.textContent.trim()),N(this,Zt,t)),t})()}}E(Yt);const te=Yt,ee=async(t,e,n,r)=>{const o=new URL(await it.resolveText(e,t),location.href);if(n){o.searchParams||(o.searchParams=new URLSearchParams);const e=o.searchParams;for(let r in n){const o=n[r];if("string"==typeof o)e.append(r,await it.resolveText(o,t));else if(o instanceof Array)for(let n of o)"string"==typeof n&&e.append(r,await it.resolveText(n,t))}}return r&&(o.hash=r),o},ne=async(t,e)=>e&&"string"==typeof e?it.resolveText(e,t):"get",re=async(t,e)=>{const n=new Headers;if(e)for(let r in e){const o=e[r];if("string"==typeof o)n.append(r,await it.resolveText(o,t));else if(o instanceof Array)for(let e of o)"string"==typeof e&&n.append(r,await it.resolveText(e,t))}return n},oe=async(t,e)=>e&&"string"==typeof e?it.resolveText(e,t):e,se=class{constructor({url:t,method:e="get",search:n,hash:r,headers:o,body:s,credentials:a,mode:i,cache:c,redirect:l,referrer:u,referrerPolicy:h}){this.url=t,this.method=e,this.search=n,this.hash=r,this.headers=o,this.body=s,this.credentials=a,this.mode=i,this.cache=c,this.redirect=l,this.referrer=u,this.referrerPolicy=h}async buildRequest({context:t}){return{url:await ee(t,this.url,this.search,this.hash),method:await ne(t,this.method),headers:await re(t,this.headers),body:await oe(t,this.body),credentials:await it.resolveText(this.credentials,t,this.credentials),mode:await it.resolveText(this.mode,t,this.mode),cache:await it.resolveText(this.cache,t,this.cache),redirect:await it.resolveText(this.redirect,t,this.redirect),referrer:await it.resolveText(this.referrer,t,this.referrer),referrerPolicy:await it.resolveText(this.referrerPolicy,t,this.referrerPolicy)}}async execute({context:t}){const{url:e,method:n,headers:r,body:o,credentials:s,mode:a,cache:i,redirect:c,referrer:l,referrerPolicy:u}=await this.buildRequest({context:t});return fetch(e.toString(),{method:n,headers:r,body:o,credentials:s,mode:a,cache:i,redirect:c,referrer:l,referrerPolicy:u})}},ae="requester",ie=b("request");class ce extends te{static get NODENAME(){return ie}constructor(){super(),this.style.display="none !important"}async reinit(){N(this,ae,null)}get request(){return(async()=>super.json)()}get requester(){return(async()=>{let t=N(this,ae);return t||(t=new se(await this.request),N(this,ae,t)),t})()}async execute(t={}){return await this.ready,(await this.requester).execute({context:t})}}E(ce);const le=ce,ue=b("typeahead"),he=A("suggestionBox"),pe=A("request"),fe=A("suugestionMap"),de=ht.load('<jstl jstl-foreach="${suggestions}" jstl-foreach-var="suggestion">\n\t<option value="${suggestion.value}">${suggestion.text}</option>\n</jstl>',!1),me=m("load-suggestion",ue),ge=m("show-suggestion",ue),ye=m("selected-suggestion",ue),ve="self-handle-selection",we="request",xe="response-suggestions",be=[],Ee=t=>{t.on(me,(e=>{e.stopPropagation();const n=e.detail;(async()=>{let e=await(async(t,e)=>{let n=(t=>{let e=pe(t);if(!e){const n=t.attr(we);e=(t=>{try{let e=find(t).first();if(e instanceof le)return e}catch(t){}return null})(n)||n,pe(t,e)}return e})(t);const r={value:e,input:t};if(n instanceof le)return n.execute(r);if("string"==typeof n){n=await it.resolveText(n,r);const t=new URL(n,location);return fetch(t.toString())}})(t,n);e=await e.json(),e=await(async(t,e)=>{t.hasAttribute(xe)&&(e=await it.resolve(t.attr(xe),e,[]));const n=t.attr("suggestion-text")||"text",r=t.attr("suggestion-value")||"value",o=[];for(let t of e){const e=typeof t;let s=null,a=null;"string"===e||"number"===e?a=s=t:(s=await it.resolveText(n,t,null),a=await it.resolveText(r,t,null)),o.push({text:s||a,value:a||s})}t.trigger(ge,o)})(t,e)})()}))};class Te extends(w(HTMLInputElement)){static get observedAttributes(){return be}static get NODENAME(){return ue}#m=!1;constructor(){super()}get selfHandleSelection(){return this.hasAttribute(ve)}set selfHandleSelection(t){t?this.attr(ve,""):this.attr(ve,null)}async init(){await super.init(),this.#m||((t=>{const e=g("id-",""),n=create(`<datalist id="${e}"></datalist>`).first();t.after(n),t.attr("list",e),he(t,n)})(this),(t=>{let e=null;t.on("input focus",(n=>{if(e&&clearTimeout(e),"input"==n.type&&(!n.inputType||"insertReplacementText"==n.inputType))return t.selfHandleSelection&&(n.preventDefault(),n.stopPropagation()),void t.trigger(ye,((t,e)=>{const n=fe(t).get(e);return n?n.data||e:null})(t,t.value));const r=t.value||"";r.length>=t.minInputSize&&(e=setTimeout((async()=>{r==t.value&&t.trigger(me,r)}),100))}))})(this),(t=>{let e=null;t.on(ge,(n=>{e&&clearTimeout(e);const r=n.detail;e=setTimeout((async()=>{t.suggestions(r)}),100)}))})(this),this.minInputSize=parseInt(this.attr("min-input-size")||"0"),this.hasAttribute(we)&&Ee(this),this.#m=!0)}async suggestions(t){await this.ready,((t,e)=>{const n=new Map;if(e)for(let t of e)n.set(t.value,t);fe(t,n)})(this,t);const e=he(this);t&&await Qt.render({container:e,template:await de,data:{suggestions:t}})}async destroy(){this.ready.resolved&&(he(this,null),pe(this,null))}}E(Te,{extends:"input"});const Ne=Te})()})();
//# sourceMappingURL=module-defaultjs-html-typeahead.min.js.map